name: Test Pipeline 妒

# Ne zaman 癟al覺s覺n?
on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

# Ne yaps覺n?
jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    # 1. Kodu ek
    - name: Checkout Code
      uses: actions/checkout@v4

    # 2. Python Kur
    - name: Set up Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: "3.12"
        cache: 'pip' # Ba覺ml覺l覺klar覺 繹nbellee al (H覺zland覺r覺r)

    # 3. Ba覺ml覺l覺klar覺 Y羹kle
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        # requirements.txt varsa y羹kle
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
        # Test ara癟lar覺n覺 y羹kle (requirements.txt i癟inde yoksa diye)
        pip install pytest pytest-cov httpx

    # 4. Model Klas繹r羹n羹 Olutur (Hata almamak i癟in)
    - name: Create Model Directory
      run: mkdir -p src/model_files

    # 5. Testleri al覺t覺r
    - name: Run Tests with Pytest
      run: |
        # -v: Detayl覺 癟覺kt覺
        # --cov: Kapsama raporu (src klas繹r羹 i癟in)
        # --cov-report=xml: Codecov i癟in rapor 羹ret
        pytest -v --cov=src --cov-report=xml
    
    # 6. (Opsiyonel) Codecov'a Rapor G繹nder
    # - name: Upload coverage to Codecov
    #   uses: codecov/codecov-action@v4
    #   env:
    #     CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}